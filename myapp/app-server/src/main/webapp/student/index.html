<!DOCTYPE html>
<html>
<<<<<<< HEAD
  <head>
    <meta charset="UTF-8" />
    <title>비트캠프 - NCP 1기</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <h1>학생</h1>

    <aside>
      <div>
        <input type="text" name="keyword" value="" />
        <button id="btn-search" type="button">검색</button>
        
        <script id="tr-template" type="text/x-handlebars-template">
          {{#each this}}
<tr data-no="{{no}}" onclick="getStudent(event)">
   <td>{{no}}</td> 
   <td>{{name}}</td> 
   <td>{{#if working}}예{{else}}아니오{{/if}}</td> 
   <td>{{tel}}</td>
</tr>
          {{/each}}
        </script>
      </div>
      <table id="student-table" border="1">
        <thead>
          <tr>
            <th>번호</th>
            <th>이름</th>
            <th>재직</th>
            <th>전화</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </aside>

    <article>
      <form id="student-form" action="update" method="post">
        <table border="1">
          <tr class="edit">
            <th>번호</th>
            <td><input id="f-no" type="text" name="no" readonly /></td>
          </tr>
          <tr>
            <th>이름</th>
            <td><input id="f-name" type="text" name="name" /></td>
          </tr>
          <tr>
            <th>이메일</th>
            <td><input id="f-email" type="email" name="email" /></td>
          </tr>
          <tr>
            <th>암호</th>
            <td><input id="f-password" type="password" name="password" /></td>
          </tr>
          <tr>
            <th>전화</th>
            <td><input id="f-tel" type="tel" name="tel" /></td>
          </tr>
          <tr>
            <th>우편번호</th>
            <td><input id="f-postNo" type="text" name="postNo" /></td>
          </tr>
          <tr>
            <th>기본주소</th>
            <td>
              <input id="f-basicAddress" type="text" name="basicAddress" />
            </td>
          </tr>
          <tr>
            <th>상세주소</th>
            <td>
              <input id="f-detailAddress" type="text" name="detailAddress" />
            </td>
          </tr>
          <tr>
            <th>재직여부</th>
            <td>
              <input
                id="f-working"
                type="checkbox"
                name="working"
                value="true"
              />
              재직중
            </td>
          </tr>
          <tr>
            <th>성별</th>
            <td>
              <input type="radio" name="gender" value="M" /> 남
              <input type="radio" name="gender" value="W" checked /> 여
            </td>
          </tr>
          <tr>
            <th>전공</th>
            <td>
              <select id="f-level" name="level">
                <option value="0">비전공자</option>
                <option value="1">준전공자</option>
                <option value="2">전공자</option>
              </select>
            </td>
          </tr>
          <tr class="edit">
            <th>등록일</th>
            <td><span id="f-createdDate"></span></td>
          </tr>
        </table>

        <div>
          <button id="btn-insert" type="button" class="input">추가</button>
          <button id="btn-update" type="button" class="edit">변경</button>
          <button id="btn-delete" type="button" class="edit">삭제</button>
          <button id="btn-cancel" type="reset" class="edit">취소</button>
        </div>
      </form>
    </article>

<script src="../node_modules/handlebars/dist/handlebars.js"></script>
<script>

const html = document.querySelector('#tr-template').innerHTML;


// 
const templateEngine = Handlebars.compile(html);


fetch("../app/students")
.then(response => {
  return response.json();
  // json()은 Promise 객체를 리턴한다.
  // Promise 객체가 하는 일:
  //   - 서버에서 응답 콘텐트를 받는 일을 한다.
  //   - 서버에서 받은 JSON 포맷의 문자열을 JavaScript 객체로 변환한다.
  //   - resolve()를 호출하여 다음 Promise 객체에 작업이 완료됐음을 통지한다.
  //     이때 변환된 JavaScript를 객체를 파라미터로 전달한다.
})
.then(result => {
  document.querySelector("#student-table > tbody").innerHTML = templateEngine(result.data);
});
</script>

    <script src="index.js"></script>
  </body>
</html>
=======
<head>
<meta charset='UTF-8'>
<title>비트캠프 - NCP 1기</title>
<style>
aside {
  border: 1px solid red;
  box-sizing: border-box;
  background-color: yellow; 
  float: left;
  width: 200px;
}

article {
  border: 1px solid black;
  box-sizing: border-box;
  margin-left: 210px;
}

#student-table > tbody > tr:hover { 
  background-color: navy;
  color: white;
}
</style>
</head>
<body>
<h1>학생(Thymeleaf)</h1>

<aside> 
<form action='list' method='get'>
  <input type='text' name='keyword' value="">
  <button>검색</button>
</form>
<div><a href='form'>새 학생</a></div>
<table id="student-table" border='1'>
<thead>
  <tr>
    <th>번호</th> <th>이름</th> <th>재직</th>
  </tr>
</thead>
<tbody></tbody>
</table>
</aside>

<article>
  <form id='student-form' action='update' method='post'>
  <table border='1'>
  <tr>
    <th>번호</th>
    <td><input id="f-no" type='text' name='no' readonly></td>
  </tr>
  <tr>
    <th>이름</th>
    <td><input id="f-name" type='text' name='name'></td>
  </tr>
  <tr>
    <th>이메일</th>
    <td><input id="f-email" type='email' name='email'></td>
  </tr>
  <tr>
    <th>암호</th>
    <td><input id="f-password" type='password' name='password'></td>
  </tr>
  <tr>
    <th>전화</th>
    <td><input id="f-tel" type='tel' name='tel'></td>
  </tr>
  <tr>
    <th>우편번호</th>
    <td><input id="f-postNo" type='text' name='postNo'></td>
  </tr>
  <tr>
    <th>기본주소</th>
    <td><input id="f-basicAddress" type='text' name='basicAddress'></td>
  </tr>
  <tr>
    <th>상세주소</th>
    <td><input id="f-detailAddress" type='text' name='detailAddress'></td>
  </tr>
  <tr>
    <th>재직여부</th>
    <td><input id="f-working" type='checkbox' name='working' value="true"> 재직중</td>
  </tr>
  <tr>
    <th>성별</th>
    <td><input type='radio' name='gender' value='M'> 남
    <input type='radio' name='gender' value='W' checked> 여</td>
  </tr>
  <tr>
    <th>전공</th>
    <td><select id="f-level" name='level'>
      <option value='0'>비전공자</option>
      <option value='1'>준전공자</option>
      <option value='2'>전공자</option>
    </select></td>
  </tr>
  <tr>
    <th>등록일</th>
    <td><span id="f-createdDate"></span></td>
  </tr>
  </table>

  <div>
    <button id='btn-insert' type='button'>추가</button>
    <button id="btn-update" type="button">변경</button>
    <button id='btn-delete' type='button'>삭제</button>
  </div>
  </form>
</article>

<script>
fetch("../admin/students")
.then(response => {
  return response.json();
})
.then(result => {
  let tbody = "";
  result.data.forEach(student => {
    let html = `
      <tr data-no="${student.no}" onclick="getStudent(event)">
         <td>${student.no}</td> 
         <td>${student.name}</td> 
         <td>${student.working ? '예' : '아니오'}</td> 
      </tr>
    `;
    tbody += html;
  });
  document.querySelector("#student-table > tbody").innerHTML = tbody;
});

function getLevelTitle(level) {
  switch (level) {
    case 0: return "비전공자";
    case 1: return "준전공자";
    case 2: return "전공자";
    default: return "기타";
  }
}

function getStudent(e) {
  let no = e.currentTarget.getAttribute('data-no');
  
  fetch('../admin/students/' + no)
  .then(response => {
    return response.json();
  })
  .then(result => {
    if (result.status == 'failure') {
      alert('학생을 조회할 수 없습니다.');
      return;
    }
    
    let student = result.data;
    console.log(student);
    document.querySelector('#f-no').value = student.no;
    document.querySelector('#f-name').value = student.name;
    document.querySelector('#f-email').value = student.email;
    document.querySelector('#f-tel').value = student.tel;
    document.querySelector('#f-postNo').value = student.postNo;
    document.querySelector('#f-basicAddress').value = student.basicAddress;
    document.querySelector('#f-detailAddress').value = student.detailAddress;
    document.querySelector('#f-working').checked = student.working;
    document.querySelector(`input[name="gender"][value="${student.gender}"]`).checked = true;
    document.querySelector('#f-level').value = student.level;
    document.querySelector('#f-createdDate').innerHTML = student.createdDate;
  });
}

document.querySelector('#btn-insert').onclick = () => {
  console.log('추가');
};

document.querySelector('#btn-update').onclick = () => {
  const form = document.querySelector('#student-form');
  const formData = new FormData(form);
  
  // FormData ==> Query String
  // 방법1) 
  // let qs = [...formData.entries()].map(x => `${encodeURIComponent(x[0])}=${encodeURIComponent(x[1])}`).join('&');
  // 방법2)
  //let qs = new URLSearchParams(formData).toString();
  //console.log(qs);
  
  let json = JSON.stringify(Object.fromEntries(formData)); 
  //console.log(json);
  
  fetch("../admin/students/" + document.querySelector('#f-no').value, {
    method: "PUT",
    headers: {
        "Content-Type": "application/json"
        //"Content-Type": "application/x-www-form-urlencoded"
    },
    //body: formData
    body: json
    //body: qs
  })
  .then(response => {
    return response.json();
  })
  .then(result => {
	  //console.log(result);
    if (result.status == 'success') {
      alert("변경 했습니다.");
      location.reload();
    } else {
      alert('변경 실패!');
      console.log(result.data);
    }
  })
  .catch(exception => {
    alert('변경 중 오류 발생!');
    console.log(exception);
  });

};

document.querySelector('#btn-delete').onclick = () => {
  console.log('삭제');
};

// entries ==> query string
function toQueryStringFromEntries(entries) {
  let qs = "";
  for (let [key, value] of entries) {
    if (qs.length > 0) {
      qs += "&";
    }
    qs += encodeURIComponent(key) + "=" + encodeURIComponent(value);
  }
  return qs;
}

function toQueryStringFromEntries2(entries) {
  let arr = [];
  for (let entry of entries) {
    arr.push(entry);
  }
  
  //console.log(arr);
  
  let arr2 = arr.map(x => `${encodeURIComponent(x[0])}=${encodeURIComponent(x[1])}`);
  //console.log(arr2);
  
  let str = arr2.join('&');
  //console.log(str);
  
  return str;
}

function toQueryStringFromEntries3(entries) {
  let arr = [...entries];
  
  //console.log(arr);
  
  let arr2 = arr.map(x => `${encodeURIComponent(x[0])}=${encodeURIComponent(x[1])}`);
  //console.log(arr2);
  
  let str = arr2.join('&');
  //console.log(str);
  
  return str;
	}

</script>


</body>
</html>


>>>>>>> d44f4ef67bc9387fe5d07c85f4fd5db4a0283b03
